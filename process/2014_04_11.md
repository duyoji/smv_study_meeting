# プロセス

## プロセスとは

メモリやCPUの実行時間をOSから借りてくる主体
メモリやCPUの実行時間はプロセス単位で割り当てられる

- メモり保護
  - 他のプロセスのメモリを読み書き出来ない
	- プロセスAにバグがあってメモリの内容を書き換えてもプロセスBは無事

1つの(または少数の)CPUコアで多数のプロセスを実行したい

- 良くない回答
  - プロセスAが終わってからプロセスBを実行
- 良い回答
  - プロセスAをちょっと実行したらプロセスBをちょっと実行する
	  - このちょっとだけ実行する単位がプロセス
		- ちょっとだけの切り分けたプロセス => タイムスライス

タイムスライスが終わる前に実行券を受け渡す事がある
  - ディスクやネットワークのI/Oが発生したときなど
	- ブロック ( ハードディスクの読み書き速度はCPUと比べるとめっちゃ時間かかる )
	- 自分から休止( sleep() )
	- 割り込み (例えばマウスカーソル)
⬇
コンテキストスイッチ(http://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81)
  - 実行中のプロセスの状態を保存しておかないと行けない
	- あとで再開するときに復元
⬇

## コンテキストスイッチとは
何を保存する
  - CPUの状態
	  - プログラムカウンタ(これがないと復帰してきたときにどこから開始してよいか分からない)
		- スタックポインタ
		  - 実行中の変数がメモリ上のどこに保存されているか記憶(関数の中で使っているローカル変数)
			- 関数の中で使っているローカル変数
		- その他のレジスタ
		  - グローバル変数とか?
	  - その他OSの情報

コンテキストスイッチが起きてプロセスが切り替わる


## プロセスの状態遷移(http://ash.jp/linux/unyo/proc_stat.gif)

生成 -> 走行可能 <--> 走行 --> ブロック |
/\                                        |
|---------------------------------------|

ここらへんの状態遷移はOSが管理しているが、このOSが管理する仕組みをスケジューリングという

## スケジューリング
- 走行可能状態にあるプロセスのうち優先度の高いものを優先的に走行状態にする
- コマンド(優先度変更など)
  - nice
	- renice
- 全てを優先度高くすると全然進まなくなる
- ここらへんの優先度を良い感じに調節する


--- 

- 協調的マルチタスク (ノンプリエンティブマルチタスク)
  - 自らCPUを明け渡すまで実行を続けることが出来る
- プリエンティブマルチタスク(今時のOSはこちらが主流)
  - OSのスケジューラによって自動的に(強制的に)CPUの明け渡しが行われる


JavaScriptでの非同期処理 -> 協調的
  - コールバックの中でいつまでも処理をしてると、ブラウザが応答しなくなる
	- setTimeoutなどで細かく処理を分ける必要がある

## プロセスの親子関係
  - 子プロセスの生成

fork : 親をコピーして子プロセスを作る
exec : 実行中の


--------------------

- 一番のルートのプロセス(PID 1)を切ったらどうなるかの話で出たワード
  - シグナルハンドラ
  - ハングアップシグナル
  - telinit
